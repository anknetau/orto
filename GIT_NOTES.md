# Git Notes

```

- Linked worktrees: Multiple working trees share one object store. Paths and HEADs differ per worktree; don’t assume a single .git/ layout (there may be a “gitfile” that points elsewhere).
- Alternate object stores (objects/info/alternates): Objects may live outside .git/objects. Backups must follow alternates.
- GC/packfile quirks (bitmaps, commit-graph, pruning): Objects move from loose → packs; unreachable/dangling can be pruned. During gc, lockfiles appear and some reads may see “quarantine” areas (receive-pack). Be tolerant of transient files and use read-only plumbing.
- Packed-refs / symbolic refs: Refs may be packed, and some are symbolic (e.g., HEAD). Don’t assume a file exists at refs/… on disk.
- Worktree encodings (working-tree-encoding): Clean recodes to UTF-8; smudge recodes back. Affects hashing and “raw vs stored” comparisons.
- Tags (annotated) and signatures: PGP/X.509 signatures on tags/commits; rewriting changes signatures. Backups may need to preserve GPG config and trust DB separately.
- Rebase/merge/cherry-pick in-progress: Presence of MERGE_HEAD, REBASE_HEAD, CHERRY_PICK_HEAD, etc. The working tree and index are in transitional states; automation should detect and avoid clobbering.
- Reflogs disabled/expired: Don’t rely on reflogs always existing. Recovery features may be limited.
- Object corruption / missing objects: Packs can be damaged; refs point to missing objects. Commands fail mid-stream; your code should degrade gracefully and report which OID is missing.
- Attributes everywhere: System, global, in-tree, and .git/info/attributes all contribute (last-wins). Don’t read only one place.
- Ignore rules in multiple layers: .gitignore, .git/info/exclude, global excludes; affects what “untracked/ignored” means.
- Commit-graph & multi-pack-index: Performance structures that alter where information lives; safe to ignore for correctness, but good to be aware of for performance/pack handling.
- Alternating newline characters inside filenames: Some plumbing (e.g., --stdin-paths) can’t represent \n in paths; choose the right porcelain (-z) or argv-based calls.
- Core settings that change behavior: core.protectNTFS, core.protectHFS, core.hidedotfiles, core.symlinks, core.filemode, core.autocrlf, core.eol—all can affect checkout and status scanning.
- Environment overrides: GIT_DIR, GIT_WORK_TREE, GIT_CEILING_DIRECTORIES, GIT_INDEX_FILE, GIT_ALTERNATE_OBJECT_DIRECTORIES, GIT_NAMESPACE can completely change what repo you’re talking to.
- Packaged archives (git archive) vs “backup”: git archive omits .git/ and can export with attributes-driven filters (e.g., export-ignore). For backups, you usually want the object database, refs, and config; for snapshots, archive is fine but loses Git metadata.
```

## Git Edge Cases

| Condition / State                          | How to Detect                                                         | Implications                                                                      | Safe Commands / APIs                         | Notes                                                                                             |
|--------------------------------------------|-----------------------------------------------------------------------|-----------------------------------------------------------------------------------|----------------------------------------------|---------------------------------------------------------------------------------------------------|
| **OID/checksum algorithm**                 | `git rev-parse --show-object-format`                                  | SHA-1 vs SHA-256                                                                  |                                              | Don’t mix families                                                                                |
| **Bare repo**                              | `git rev-parse --is-bare-repository`                                  | No working tree                                                                   | `cat-file`, `ls-tree`, `rev-list`            | Guard any WT access                                                                               |
| **Linked worktrees**                       | `git worktree list --porcelain -z`                                    | Multiple WTs share objects; `.git` may be a gitfile                               | Always run with `-C <worktree>`              | Track per-WT HEAD/index                                                                           |
| **Linked worktrees**                       | `git worktree list --porcelain`                                       | Multiple worktrees share objects                                                  | Run with `-C <worktree>`                     | `.git` may be a gitfile                                                                           |
| **Sparse checkout**                        | `git sparse-checkout list` (git ls-files -t returns S for some files) | Index has `skip-worktree`, WT intentionally incomplete                            | `status --porcelain=v2`, `ls-files --sparse` | Avoid raw index rewrites                                                                          |
| **Submodules (gitlink)**                   |                                                                       | Submodules = trees, point to commit in another repo.                              |                                              |                                                                                                   |
| **Subtress**                               |                                                                       | Subtrees are merged content—ordinary files/dirs but with history spliced.         |                                              |                                                                                                   |
| **Sparse index**                           | `git ls-files --format='%(name) %(sparse)'`                           | Index dir entries collapse subtrees                                               | Prefer porcelain                             | Expand with `git sparse-checkout reapply` if needed                                               |
| **Split index**                            | `git config core.splitIndex`                                          | Index split between base + overlay                                                | Use porcelain                                | Don’t rewrite index directly                                                                      |
| **Index conflicts**                        | `git ls-files -u`                                                     | Multiple blobs per path                                                           | Use `ls-files -s/-u`                         | Stages 1/2/3. A path can have multiple index entries (base/ours/theirs). Don’t assume 1 blob/path |
| **Intent-to-add**                          | `git ls-files -t`                                                     | File recorded in index without content yet; status shows it, but there’s no blob. | Status shows it                              | Guard for missing blob                                                                            |
| **Partial clone / promisor**               | `git config remote.*.promisor`                                        | Blobs may be missing. Accessing content can trigger network fetch.                | `ls-tree`, `cat-file -t`                     | Trees may reference missing blobs that are promised by the remote.                                |
| **Shallow clone**                          | `git rev-parse --is-shallow-repository`                               | Truncated history                                                                 | WT ops are OK                                | `fetch --unshallow` to heal                                                                       |
| **Replace refs**                           | `git show-ref refs/replace/`                                          | Normal reads return replaced objects                                              | `--no-replace-objects`                       | May hide originals                                                                                |
| **Grafts**                                 | `.git/info/grafts`                                                    | Alters ancestry                                                                   | Same as replace refs                         | Legacy feature, rare                                                                              |
| **Notes**                                  | `git notes list`                                                      | Metadata outside objects                                                          | Include notes refs in backups                | Separate refs namespace                                                                           |
| **Alternate object stores**                | `.git/objects/info/alternates`                                        | Objects live outside repo                                                         | Follow alternates                            | Also via env `GIT_ALTERNATE_OBJECT_DIRECTORIES`                                                   |
| **GC / packs**                             | `.pack` changes, `.lock` files                                        | Objects move, pruned                                                              | Read-only plumbing                           | Retry on errors                                                                                   |
| **Locks, GC / packfile activity**          | `.pack` changes, `.lock` files / index.lock /packed-refs.lock         | Objects move, prunes occur                                                        | Read-only plumbing                           | Need to be able to retry                                                                          |
| **Quarantine (receive-pack)**              | Server-side only                                                      | New objects temp quarantined                                                      | Mostly server concern                        | Hooks see quarantine                                                                              |
| **Packed refs / symrefs**                  | `git show-ref --head`; `symbolic-ref`                                 | Refs packed/symbolic                                                              | Use porcelain                                | Avoid raw file parsing                                                                            |
| **Detached HEAD / orphan branches**        | `git symbolic-ref -q HEAD` fails                                      | No branch/upstream                                                                | Handle explicitly                            | Don’t assume branch exists                                                                        |
| **Refs namespaces**                        | `$GIT_NAMESPACE`                                                      | Scoped view of refs                                                               | Be explicit                                  | Server multi-tenant                                                                               |
| **Assume-unchanged / skip-worktree bits**  | `git ls-files -v/-t`                                                  | Status ignores changes                                                            | `update-index` to clear bits                 | Skip-worktree is central to sparse                                                                |
| **Filemode tracking off**                  | `git config core.filemode=false`                                      | Executable bit ignored                                                            | Don’t rely on mode changes                   | Cross-platform quirk, affects diffs                                                               |
| **Case-sensitivity and unicode filenames** | `git config core.ignorecase` `core.precomposeunicode`                 | WT scan case-folded                                                               | Prefer Git porcelain                         | Collisions possible                                                                               |
| **Symlink semantics**                      | `git config core.symlinks`                                            | Symlinks may be files rather than actual symlinks                                 | Blobs store link target                      | On Windows often disabled; [see this](https://gitforwindows.org/symbolic-links.html)              |
| **EOL normalization**                      | `core.autocrlf`, attrs                                                | Text blobs stored LF; WT may be CRLF                                              | `hash-object` or normalize                   | 8KB Heuristic if no attrs                                                                         |
| **Working-tree encoding**                  | `git check-attr working-tree-encoding`                                | WT re-encoded on clean                                                            | Run Git filter                               | Raw hash won’t match                                                                              |
| **Ident expansion**                        | `git check-attr ident`                                                | `$Id$` expanded/collapsed                                                         | Must run clean filter                        | Rare but breaks naive hash                                                                        |
| **Custom filters / LFS**                   | `git check-attr filter`                                               | Content transformed; uses smudge / clean.                                         | `hash-object` / `cat-file --filters`         | LFS stores pointer blobs; see [this](https://stackoverflow.com/questions/74815517/)               |
| **FSMonitor / Watchman integration**       | `git config core.fsmonitor`                                           | Status perf depends on FS notify                                                  | Use porcelain                                | File scans may differ                                                                             |
| **Long paths / reserved names (Windows)**  | Checkout/stat failures                                                | Path mangling                                                                     | Prefer porcelain                             | See `core.protect*`, see also ACL / permissions in Windows                                        |
| **Hooks**                                  | `.git/hooks/*`, `core.hooksPath`                                      | Can alter or block                                                                | Prefer plumbing                              | Don’t assume hooks ran                                                                            |
| **Untracked / ignored**                    | `status --porcelain=v2 --ignored -z`                                  | Needed for full view                                                              | Parse porcelain                              | Combine with `ls-files`                                                                           |
| **Env overrides**                          | `GIT_DIR`, `GIT_WORK_TREE`, etc.                                      | Repo location may differ                                                          | Pin with `-C`                                | Sanitize env in tools                                                                             |
| **Safe directory checks**                  | `safe.directory`                                                      |                                                                                   | **Safe directory checks**                    | Git can refuse to run in repo owned by another user unless whitelisted                            |

## Handy commands

- Attributes: `git check-attr -a -- path -z`
- Canonical blob bytes: `git cat-file --filters -- path`
- Canonical blob OID: `git hash-object --path path -- path`
- Index view: `git ls-files -s/-u/-v/-t`
- Status w/ignored: `git status --porcelain=v2 --ignored -z`
- Worktrees: `git worktree list --porcelain`
- Partial/promisor: `git config --get-regexp 'remote\..*\.promisor|extensions.partialClone'`
